<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts Viewer</title>
  </head>

  <body>
    <h1>Posts</h1>
    <div id="posts-container"></div>

    <h2>Create New Post</h2>
    <form id="new-post-form">
      <label for="title">Title:</label>
      <input type="text" id="title" required><br>

      <label for="author">Author:</label>
      <input type="text" id="author" required><br>

      <!-- Hidden input to store post ID for updates -->
      <input type="hidden" id="post-id" name="post-id">

      <button type="submit">Create Post</button>
    </form>

    <script>
      async function fetchPosts() {
        try {
          const response = await fetch('http://localhost:3000/posts');
          const data = await response.json();
          displayPosts(data);
        } catch (error) {
          console.error('Error fetching posts:', error);
        }
      }

      function displayPosts(posts) {
        const container = document.getElementById('posts-container');

        if (posts.length === 0) {
          container.innerHTML = '<p>No posts available</p>';
          return;
        }

        const postList = posts.map(post => {
          return `<div>
                <strong>Title:</strong> ${post.title || 'N/A'}<br>
                <strong>Author:</strong> ${post.author || 'N/A'}<br>
                <strong>ID:</strong> ${post.id || 'N/A'}<br>
                <button onclick="deletePost(${post.id})">Delete</button>
                <button onclick="editPost(${post.id})">Edit</button>
              </div><br>`;
        }).join('');

        container.innerHTML = postList;
      }

      document.addEventListener('DOMContentLoaded', fetchPosts);

      document.getElementById('new-post-form').addEventListener('submit', function (event) {
        event.preventDefault();

        const titleInput = document.getElementById('title');
        const authorInput = document.getElementById('author');
        const postIdInput = document.getElementById('post-id');

        const postData = {
          title: titleInput.value,
          author: authorInput.value
        };

        if (postIdInput.value) {
          // If post ID exists, it's an update
          updatePost(postIdInput.value, postData);
        } else {
          // Otherwise, it's a new post
          createPost(postData);
        }

        // Clear the form
        titleInput.value = '';
        authorInput.value = '';
        postIdInput.value = '';

        // Change the form submit button back to Create Post
        document.querySelector('button[type="submit"]').innerText = 'Create Post';
      });

      function editPost(postId) {
        fetch(`http://localhost:3000/posts/${postId}`)
          .then(response => response.json())
          .then(post => {
            document.getElementById('title').value = post.title || '';
            document.getElementById('author').value = post.author || '';
            document.getElementById('post-id').value = post.id;

            // Change the form submit button to Update Post
            document.querySelector('button[type="submit"]').innerText = 'Update Post';
          })
          .catch(error => {
            console.error(`Error fetching post with ID ${postId} for editing:`, error);
          });
      }

      async function createPost(newPost) {
        try {
          const response = await fetch('http://localhost:3000/posts', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(newPost),
          });
          const data = await response.json();
          fetchPosts();
        } catch (error) {
          console.error('Error creating post:', error);
        }
      }

      async function updatePost(postId, updatedPost) {
        try {
          const response = await fetch(`http://localhost:3000/posts/${postId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(updatedPost),
          });
          const data = await response.json();
          fetchPosts();
        } catch (error) {
          console.error(`Error updating post with ID ${postId}:`, error);
        }
      }

      async function deletePost(postId) {
        try {
          const response = await fetch(`http://localhost:3000/posts/${postId}`, {
            method: 'DELETE',
          });
          const data = await response.json();
          fetchPosts();
        } catch (error) {
          console.error(`Error deleting post with ID ${postId}:`, error);
        }
      }
    </script>
  </body>

</html>
