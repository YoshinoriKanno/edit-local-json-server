<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts Viewer</title>
  </head>

  <body>
    <h1>Posts</h1>
    <div id="posts-container"></div>

    <h2>Create New Post</h2>
    <form id="new-post-form">
      <label for="title">Title:</label>
      <input type="text" id="title" required><br>

      <label for="author">Author:</label>
      <input type="text" id="author" required><br>

      <!-- Hidden input to store post ID for updates -->
      <input type="hidden" id="post-id" name="post-id">

      <button type="submit">Create Post</button>
    </form>

    <script>
      const apiUrl = 'http://localhost:3000/posts';
      const postsContainer = document.getElementById('posts-container');
      const titleInput = document.getElementById('title');
      const authorInput = document.getElementById('author');
      const postIdInput = document.getElementById('post-id');
      const submitButton = document.querySelector('button[type="submit"]');

      document.addEventListener('DOMContentLoaded', fetchPosts);
      document.getElementById('new-post-form').addEventListener('submit', handleFormSubmit);

      function fetchPosts() {
        try {
          fetch(apiUrl)
            .then(response => response.json())
            .then(displayPosts)
            .catch(handleError);
        } catch (error) {
          console.error('Error fetching posts:', error);
        }
      }

      function displayPosts(posts) {
        if (posts.length === 0) {
          postsContainer.innerHTML = '<p>No posts available</p>';
          return;
        }

        const postList = posts
          .map(post => `
            <div>
              <strong>Title:</strong> ${post.title || 'N/A'}<br>
              <strong>Author:</strong> ${post.author || 'N/A'}<br>
              <strong>ID:</strong> ${post.id || 'N/A'}<br>
              <button onclick="deletePost(${post.id})">Delete</button>
              <button onclick="editPost(${post.id})">Edit</button>
            </div><br>
          `)
          .join('');

        postsContainer.innerHTML = postList;
      }

      function handleFormSubmit(event) {
        event.preventDefault();

        const postData = {
          title: titleInput.value,
          author: authorInput.value,
        };

        if (postIdInput.value) {
          updatePost(postIdInput.value, postData);
        } else {
          createPost(postData);
        }

        clearForm();
        submitButton.innerText = 'Create Post';
      }

      function editPost(postId) {
        fetch(`${apiUrl}/${postId}`)
          .then(response => response.json())
          .then(post => {
            titleInput.value = post.title || '';
            authorInput.value = post.author || '';
            postIdInput.value = post.id;
            submitButton.innerText = 'Update Post';
          })
          .catch(error => {
            console.error(`Error fetching post with ID ${postId} for editing:`, error);
          });
      }

      async function createPost(newPost) {
        try {
          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(newPost),
          });
          const data = await response.json();
          fetchPosts();
        } catch (error) {
          console.error('Error creating post:', error);
        }
      }

      async function updatePost(postId, updatedPost) {
        try {
          const response = await fetch(`${apiUrl}/${postId}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(updatedPost),
          });
          const data = await response.json();
          fetchPosts();
        } catch (error) {
          console.error(`Error updating post with ID ${postId}:`, error);
        }
      }

      async function deletePost(postId) {
        try {
          const response = await fetch(`${apiUrl}/${postId}`, {
            method: 'DELETE',
          });
          const data = await response.json();
          fetchPosts();
        } catch (error) {
          console.error(`Error deleting post with ID ${postId}:`, error);
        }
      }

      function clearForm() {
        titleInput.value = '';
        authorInput.value = '';
        postIdInput.value = '';
      }

      function handleError(error) {
        console.error('An error occurred:', error);
      }
    </script>

  </body>

</html>
